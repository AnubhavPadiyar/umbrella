<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Umbrella — Uttarakhand Disaster Intelligence</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&family=Lora:wght@400;600&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg:        #f4f1eb;
      --bg2:       #ffffff;
      --bg3:       #edeae2;
      --navy:      #1a2744;
      --navy2:     #243358;
      --red:       #c0392b;
      --red-dim:   rgba(192,57,43,0.08);
      --orange:    #d35400;
      --orange-dim:rgba(211,84,0,0.08);
      --green:     #1e7e4a;
      --green-dim: rgba(30,126,74,0.08);
      --border:    #ddd9ce;
      --border2:   #c8c3b5;
      --text:      #1a1a1a;
      --muted:     #6b6456;
      --muted2:    #8c8070;
      --serif:     'Lora', Georgia, serif;
      --sans:      'Instrument Sans', sans-serif;
      --mono:      'IBM Plex Mono', monospace;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      min-height: 100vh;
    }

    .navbar {
      background-color: var(--navy);
      padding: 0 48px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 56px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
    }

    .logo-mark {
      width: 28px;
      height: 28px;
      background: white;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
    }

    .logo-text {
      font-size: 15px;
      font-weight: 700;
      color: white;
      letter-spacing: 1px;
    }

    .logo-sub {
      font-size: 10px;
      color: rgba(255,255,255,0.45);
      letter-spacing: 0.5px;
      margin-top: 1px;
    }

    .nav-links { display: flex; gap: 4px; list-style: none; }

    .nav-links a {
      color: rgba(255,255,255,0.65);
      text-decoration: none;
      font-size: 13px;
      padding: 6px 14px;
      border-radius: 3px;
      transition: all 0.15s;
      font-weight: 500;
    }

    .nav-links a:hover { color: white; background: rgba(255,255,255,0.1); }
    .nav-links a.active { color: white; background: rgba(255,255,255,0.15); }

    .alert-ticker {
      background: var(--navy2);
      padding: 8px 48px;
      display: flex;
      align-items: center;
      gap: 14px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .ticker-label {
      font-family: var(--mono);
      font-size: 10px;
      color: rgba(255,255,255,0.4);
      letter-spacing: 1.5px;
      text-transform: uppercase;
    }

    .ticker-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: #4ade80;
      animation: blink 2s infinite;
    }

    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

    .ticker-text {
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,0.75);
    }

    .ticker-time {
      margin-left: auto;
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,0.35);
    }

    .hero {
      background: var(--navy);
      padding: 52px 48px 44px;
      display: grid;
      grid-template-columns: 1fr auto;
      gap: 48px;
      align-items: end;
      border-bottom: 3px solid var(--red);
    }

    .hero-eyebrow {
      font-family: var(--mono);
      font-size: 10px;
      letter-spacing: 2px;
      text-transform: uppercase;
      color: rgba(255,255,255,0.35);
      margin-bottom: 16px;
    }

    .hero-title {
      font-family: var(--serif);
      font-size: clamp(32px, 4vw, 52px);
      font-weight: 600;
      color: white;
      line-height: 1.2;
      margin-bottom: 14px;
    }

    .hero-title em { color: rgba(255,255,255,0.45); font-style: normal; }

    .hero-desc {
      font-size: 14px;
      color: rgba(255,255,255,0.55);
      line-height: 1.65;
      max-width: 480px;
    }

    .hero-right { text-align: right; }

    .hero-clock {
      font-family: var(--mono);
      font-size: 30px;
      font-weight: 500;
      color: white;
      line-height: 1;
      margin-bottom: 6px;
    }

    .hero-date {
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(255,255,255,0.35);
    }

    .threat-card {
      padding: 18px 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-left: 4px solid;
      background: var(--bg2);
      border-bottom: 1px solid var(--border);
      border-right: 1px solid var(--border);
    }

    .threat-card.low    { border-left-color: var(--green); }
    .threat-card.medium { border-left-color: var(--orange); }
    .threat-card.high   { border-left-color: var(--red); }

    .threat-left { display: flex; align-items: center; gap: 18px; }

    .threat-badge {
      font-family: var(--mono);
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 1.5px;
      text-transform: uppercase;
      padding: 4px 10px;
      border-radius: 2px;
    }

    .threat-badge.low    { background: var(--green-dim);  color: var(--green); }
    .threat-badge.medium { background: var(--orange-dim); color: var(--orange); }
    .threat-badge.high   { background: var(--red-dim);    color: var(--red); }

    .threat-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 2px; }
    .threat-desc  { font-size: 12px; color: var(--muted); }

    .threat-right { display: flex; align-items: baseline; gap: 5px; }

    .threat-mm {
      font-family: var(--mono);
      font-size: 26px;
      font-weight: 500;
    }

    .threat-mm-unit {
      font-family: var(--mono);
      font-size: 11px;
      color: var(--muted2);
    }

    .main {
      padding: 28px 48px;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
    }

    .stat-strip {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1px;
      background: var(--border);
      border: 1px solid var(--border);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .stat-cell {
      background: var(--bg2);
      padding: 18px 18px 14px;
      position: relative;
    }

    .stat-cell::after {
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 3px;
    }

    .stat-cell.s-navy::after   { background: var(--navy); }
    .stat-cell.s-red::after    { background: var(--red); }
    .stat-cell.s-orange::after { background: var(--orange); }
    .stat-cell.s-green::after  { background: var(--green); }

    .stat-label {
      font-size: 10px;
      font-weight: 600;
      color: var(--muted2);
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 8px;
    }

    .stat-value {
      font-family: var(--mono);
      font-size: 32px;
      font-weight: 500;
      line-height: 1;
      margin-bottom: 4px;
      color: var(--text);
    }

    .stat-sub { font-size: 11px; color: var(--muted2); }

    .table-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 4px;
      overflow: hidden;
    }

    .table-card-header {
      padding: 14px 20px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg3);
    }

    .table-card-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--muted);
      letter-spacing: 0.8px;
      text-transform: uppercase;
    }

    .district-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }

    .district-table th {
      text-align: left;
      font-size: 10px;
      font-weight: 600;
      color: var(--muted2);
      letter-spacing: 0.8px;
      text-transform: uppercase;
      padding: 10px 20px;
      background: var(--bg3);
      border-bottom: 1px solid var(--border);
    }

    .district-table td {
      padding: 13px 20px;
      border-bottom: 1px solid var(--border);
    }

    .district-table tr:last-child td { border-bottom: none; }
    .district-table tr:hover td { background: var(--bg3); }

    .district-name { font-weight: 600; color: var(--navy); }
    .district-river { font-size: 11px; color: var(--muted2); margin-top: 2px; }

    .mm-val {
      font-family: var(--mono);
      font-size: 14px;
      font-weight: 500;
    }

    .risk-tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 2px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      font-family: var(--mono);
    }

    .risk-tag.high   { background: var(--red-dim);    color: var(--red); }
    .risk-tag.medium { background: var(--orange-dim); color: var(--orange); }
    .risk-tag.low    { background: var(--green-dim);  color: var(--green); }

    .sidebar { display: flex; flex-direction: column; gap: 16px; }

    .side-card {
      background: var(--bg2);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 18px;
    }

    .side-card-title {
      font-size: 10px;
      font-weight: 600;
      color: var(--muted);
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: 14px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .qnav-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid var(--border);
      text-decoration: none;
      transition: all 0.15s;
    }

    .qnav-item:last-child { border-bottom: none; }
    .qnav-item:hover .qn-t { color: var(--navy); }
    .qnav-item:hover .qn-a { transform: translateX(3px); }

    .qn-t {
      font-size: 13px;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 2px;
      transition: color 0.15s;
    }

    .qn-d { font-size: 11px; color: var(--muted2); }
    .qn-a { color: var(--muted2); font-size: 14px; transition: transform 0.15s; }

    .threshold-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 9px 0;
      border-bottom: 1px solid var(--border);
    }

    .threshold-row:last-child { border-bottom: none; }

    .about-text {
      font-size: 12px;
      color: var(--muted);
      line-height: 1.65;
      margin-bottom: 12px;
    }

    .tag {
      display: inline-block;
      background: var(--bg3);
      border: 1px solid var(--border2);
      color: var(--muted);
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 2px;
      font-family: var(--mono);
      margin: 2px;
    }

    .footer {
      background: var(--navy);
      padding: 18px 48px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .footer-l { font-size: 12px; color: rgba(255,255,255,0.35); }
    .footer-r { font-family: var(--mono); font-size: 11px; color: rgba(255,255,255,0.25); }

    .fade-up {
      opacity: 0;
      transform: translateY(8px);
      animation: fu 0.4s ease forwards;
    }

    @keyframes fu { to { opacity:1; transform:translateY(0); } }
    .d1{animation-delay:.05s} .d2{animation-delay:.1s}
    .d3{animation-delay:.15s} .d4{animation-delay:.2s}
  </style>
</head>

<body>

  <nav class="navbar">
    <a class="logo" href="index.html">
      <div class="logo-mark">☂</div>
      <div>
        <div class="logo-text">Umbrella</div>
        <div class="logo-sub">Disaster Intelligence · Uttarakhand</div>
      </div>
    </a>
    <ul class="nav-links">
      <li><a href="index.html" class="active">Dashboard</a></li>
      <li><a href="map.html">Risk Map</a></li>
      <li><a href="vulnerability.html">Vulnerability</a></li>
      <li><a href="resources.html">Resources</a></li>
      <li><a href="admin.html">Admin</a></li>
    </ul>
  </nav>

  <div class="alert-ticker">
    <span class="ticker-label">Live</span>
    <div class="ticker-dot"></div>
    <span class="ticker-text" id="ticker-text">Connecting to rainfall monitoring network...</span>
    <span class="ticker-time" id="ticker-time">—</span>
  </div>

  <div class="hero">
    <div>
      <div class="hero-eyebrow">Multi-Hazard Early Warning System · Uttarakhand</div>
      <h1 class="hero-title">
        Disaster Intelligence<br>
        <em>for the Himalayan Region</em>
      </h1>
      <p class="hero-desc">
        Real-time flood and GLOF risk assessment across 6 districts.
        Live rainfall data, village vulnerability scoring, and automated
        deployment recommendations for emergency responders.
      </p>
    </div>
    <div class="hero-right">
      <div class="hero-clock" id="live-time">--:--:--</div>
      <div class="hero-date" id="live-date">Loading...</div>
    </div>
  </div>

  <div class="threat-card low fade-up d1" id="threat-card">
    <div class="threat-left">
      <span class="threat-badge low" id="threat-badge">Assessing</span>
      <div>
        <div class="threat-title" id="threat-title">Loading current threat assessment...</div>
        <div class="threat-desc" id="threat-desc">Connecting to rainfall monitoring network</div>
      </div>
    </div>
    <div class="threat-right">
      <span class="threat-mm" id="threat-mm" style="color:var(--muted2)">—</span>
      <span class="threat-mm-unit">mm peak / 48hr</span>
    </div>
  </div>

  <div class="main">
    <div>
      <div class="stat-strip fade-up d2">
        <div class="stat-cell s-navy">
          <div class="stat-label">Hazard Modules</div>
          <div class="stat-value" id="stat-modules">—</div>
          <div class="stat-sub">Active systems</div>
        </div>
        <div class="stat-cell s-red">
          <div class="stat-label">Districts</div>
          <div class="stat-value" id="stat-districts">—</div>
          <div class="stat-sub">Under watch</div>
        </div>
        <div class="stat-cell s-orange">
          <div class="stat-label">Villages</div>
          <div class="stat-value" id="stat-villages">—</div>
          <div class="stat-sub">Scored live</div>
        </div>
        <div class="stat-cell s-green">
          <div class="stat-label">Updated</div>
          <div class="stat-value" id="stat-time" style="font-size:20px;padding-top:6px;">—</div>
          <div class="stat-sub">Rainfall refresh</div>
        </div>
      </div>

      <div class="table-card fade-up d3">
        <div class="table-card-header">
          <span class="table-card-title">Live District Rainfall — 48hr Cumulative</span>
          <span style="font-family:var(--mono);font-size:10px;color:var(--muted2);">Source: Open-Meteo API</span>
        </div>
        <table class="district-table">
          <thead>
            <tr>
              <th>District</th>
              <th>Major Rivers</th>
              <th>48hr Rainfall</th>
              <th>IMD Status</th>
            </tr>
          </thead>
          <tbody id="district-tbody">
            <tr>
              <td colspan="4" style="text-align:center;color:var(--muted2);padding:24px;">
                Loading rainfall data...
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <div class="sidebar fade-up d4">

      <div class="side-card">
        <div class="side-card-title">Module Access</div>
        <a href="map.html" class="qnav-item">
          <div><div class="qn-t">Risk Map</div><div class="qn-d">GLOF lakes · Flood zones · Live overlay</div></div>
          <span class="qn-a">→</span>
        </a>
        <a href="vulnerability.html" class="qnav-item">
          <div><div class="qn-t">Vulnerability Scorer</div><div class="qn-d">Live risk scores for all villages</div></div>
          <span class="qn-a">→</span>
        </a>
        <a href="resources.html" class="qnav-item">
          <div><div class="qn-t">Resource Recommender</div><div class="qn-d">NDRF orders · Evacuation · Alerts</div></div>
          <span class="qn-a">→</span>
        </a>
      </div>

      <div class="side-card">
        <div class="side-card-title">IMD Rainfall Thresholds</div>
        <div class="threshold-row">
          <div>
            <div style="font-size:13px;font-weight:600;color:var(--red)">High Risk</div>
            <div style="font-size:11px;color:var(--muted2)">NDRF deployment triggered</div>
          </div>
          <span style="font-family:var(--mono);font-size:13px;color:var(--red)">≥ 115mm</span>
        </div>
        <div class="threshold-row">
          <div>
            <div style="font-size:13px;font-weight:600;color:var(--orange)">Elevated</div>
            <div style="font-size:11px;color:var(--muted2)">SDRF on standby</div>
          </div>
          <span style="font-family:var(--mono);font-size:13px;color:var(--orange)">65–115mm</span>
        </div>
        <div class="threshold-row">
          <div>
            <div style="font-size:13px;font-weight:600;color:var(--green)">Normal</div>
            <div style="font-size:11px;color:var(--muted2)">Routine monitoring</div>
          </div>
          <span style="font-family:var(--mono);font-size:13px;color:var(--green)">< 65mm</span>
        </div>
      </div>

      <div class="side-card">
        <div class="side-card-title">About Umbrella</div>
        <p class="about-text">
          Multi-hazard early warning dashboard covering GLOF and flood risk
          across the Uttarakhand Himalayan region. Validated against the
          2013 Kedarnath disaster (score: 85/100 — HIGH).
        </p>
        <div>
          <span class="tag">Open-Meteo API</span>
          <span class="tag">Flask + SQLite</span>
          <span class="tag">IMD Thresholds</span>
          <span class="tag">ISRO Coordinates</span>
        </div>
      </div>

    </div>
  </div>

  <div class="footer">
    <div class="footer-l">Umbrella Early Warning System · Uttarakhand · Built by Anubhav Padiyar, Civil Engineering</div>
    <div class="footer-r">github.com/AnubhavPadiyar/umbrella</div>
  </div>

  <script>
    var BACKEND = "https://web-production-517aa.up.railway.app";

    var RIVERS = {
      "Uttarkashi":    "Bhagirathi, Yamuna",
      "Chamoli":       "Alaknanda, Pindar",
      "Rudraprayag":   "Mandakini, Alaknanda",
      "Tehri Garhwal": "Bhagirathi, Bhilangna",
      "Pithoragarh":   "Kali, Gori",
      "Haridwar":      "Ganga"
    };

    function updateClock() {
      var now = new Date();
      document.getElementById('live-time').innerText =
        now.toLocaleTimeString('en-IN', { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false });
      document.getElementById('live-date').innerText =
        now.toLocaleDateString('en-IN', { weekday:'long', day:'numeric', month:'long', year:'numeric' });
      document.getElementById('ticker-time').innerText =
        now.toLocaleTimeString('en-IN', { hour:'2-digit', minute:'2-digit', hour12:true });
    }

    updateClock();
    setInterval(updateClock, 1000);

    function countUp(id, target) {
      var el = document.getElementById(id);
      if (typeof target === 'string') { el.innerText = target; return; }
      var s = 0, step = target / 40;
      var t = setInterval(function() {
        s += step;
        if (s >= target) { s = target; clearInterval(t); }
        el.innerText = Math.floor(s);
      }, 16);
    }

    fetch(BACKEND + "/rainfall")
      .then(function(r) { return r.json(); })
      .then(function(data) {
        var districts = data.districts;
        var peakMm = 0, peakDist = '';

        districts.forEach(function(d) {
          if (d.mm_48hr > peakMm) { peakMm = d.mm_48hr; peakDist = d.district; }
        });

        var risk  = peakMm >= 115 ? 'high' : peakMm >= 65 ? 'medium' : 'low';
        var color = risk==='high' ? 'var(--red)' : risk==='medium' ? 'var(--orange)' : 'var(--green)';

        var card  = document.getElementById('threat-card');
        var badge = document.getElementById('threat-badge');
        card.className  = 'threat-card ' + risk + ' fade-up d1';
        badge.className = 'threat-badge ' + risk;
        badge.innerText = risk.toUpperCase();

        document.getElementById('threat-mm').innerText   = peakMm + 'mm';
        document.getElementById('threat-mm').style.color = color;

        if (risk === 'high') {
          document.getElementById('threat-title').innerText =
            'High Threat — Immediate action required in ' + peakDist;
          document.getElementById('threat-desc').innerText =
            'Rainfall exceeds IMD extreme threshold. NDRF deployment recommended.';
        } else if (risk === 'medium') {
          document.getElementById('threat-title').innerText =
            'Elevated Alert — Heavy rainfall recorded in ' + peakDist;
          document.getElementById('threat-desc').innerText =
            'Approaching danger threshold. SDRF teams on standby.';
        } else {
          document.getElementById('threat-title').innerText =
            'Normal Conditions — All districts within safe rainfall limits';
          document.getElementById('threat-desc').innerText =
            'Continuous monitoring active across all ' + districts.length + ' districts.';
        }

        document.getElementById('ticker-text').innerText =
          'Assessment complete — ' + districts.length + ' districts monitored — Peak: ' +
          peakMm + 'mm in ' + peakDist + ' (48hr)';

        countUp('stat-modules', 4);
        countUp('stat-districts', 6);
        countUp('stat-villages', 16);
        countUp('stat-time', new Date().toLocaleTimeString('en-IN', {
          hour:'2-digit', minute:'2-digit', hour12:false
        }));

        var tbody = document.getElementById('district-tbody');
        tbody.innerHTML = '';
        districts.forEach(function(d) {
          var r = d.risk.toLowerCase();
          var c = r==='high' ? 'var(--red)' : r==='medium' ? 'var(--orange)' : 'var(--green)';
          tbody.innerHTML +=
            '<tr>' +
              '<td><div class="district-name">' + d.district + '</div></td>' +
              '<td style="color:var(--muted2);font-size:12px;">' + (RIVERS[d.district]||'—') + '</td>' +
              '<td><span class="mm-val" style="color:' + c + '">' + d.mm_48hr + '</span> <span style="font-size:11px;color:var(--muted2)">mm</span></td>' +
              '<td><span class="risk-tag ' + r + '">' + d.risk + '</span></td>' +
            '</tr>';
        });
      })
      .catch(function() {
        document.getElementById('threat-title').innerText = 'Backend server offline';
        document.getElementById('threat-desc').innerText  = 'Run: python3 server.py in Terminal';
        document.getElementById('ticker-text').innerText  = 'Connection failed — backend not responding';
      });
  </script>

</body>
</html>
