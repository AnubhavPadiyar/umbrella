<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Umbrella ‚Äî Admin Panel</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&family=Lora:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg:#f4f1eb;--bg2:#ffffff;--bg3:#edeae2;
      --navy:#1a2744;--navy2:#243358;
      --red:#c0392b;--red-dim:rgba(192,57,43,0.08);
      --orange:#d35400;--orange-dim:rgba(211,84,0,0.08);
      --green:#1e7e4a;--green-dim:rgba(30,126,74,0.08);
      --border:#ddd9ce;--border2:#c8c3b5;
      --text:#1a1a1a;--muted:#6b6456;--muted2:#8c8070;
      --serif:'Lora',Georgia,serif;
      --sans:'Instrument Sans',sans-serif;
      --mono:'IBM Plex Mono',monospace;
    }
    *{margin:0;padding:0;box-sizing:border-box;}
    body{background:var(--bg);color:var(--text);font-family:var(--sans);min-height:100vh;}
    .navbar{background:var(--navy);padding:0 48px;display:flex;align-items:center;justify-content:space-between;height:56px;position:sticky;top:0;z-index:100;}
    .logo{display:flex;align-items:center;gap:12px;text-decoration:none;}
    .logo-mark{width:28px;height:28px;background:white;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:16px;}
    .logo-text{font-size:15px;font-weight:700;color:white;letter-spacing:1px;}
    .logo-sub{font-size:10px;color:rgba(255,255,255,0.45);margin-top:1px;}
    .nav-links{display:flex;gap:4px;list-style:none;}
    .nav-links a{color:rgba(255,255,255,0.65);text-decoration:none;font-size:13px;padding:6px 14px;border-radius:3px;transition:all .15s;font-weight:500;}
    .nav-links a:hover{color:white;background:rgba(255,255,255,0.1);}
    .nav-links a.active{color:white;background:rgba(255,255,255,0.15);}
    .page-header{background:var(--navy);padding:40px 48px 36px;border-bottom:3px solid var(--orange);display:flex;align-items:flex-end;justify-content:space-between;}
    .page-eyebrow{font-family:var(--mono);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:rgba(255,255,255,0.35);margin-bottom:10px;}
    .page-title{font-family:var(--serif);font-size:36px;font-weight:600;color:white;margin-bottom:8px;}
    .page-desc{font-size:13px;color:rgba(255,255,255,0.5);}
    .admin-note{background:rgba(211,84,0,0.15);border-left:3px solid var(--orange);padding:12px 48px;font-size:12px;color:rgba(255,255,255,0.75);font-family:var(--mono);color:#d35400;}
    .content{padding:32px 48px 48px;display:grid;grid-template-columns:380px 1fr;gap:24px;align-items:start;}
    .form-card{background:var(--bg2);border:1px solid var(--border);border-radius:4px;overflow:hidden;position:sticky;top:76px;}
    .form-header{padding:16px 20px;background:var(--bg3);border-bottom:1px solid var(--border);}
    .form-title{font-size:11px;font-weight:600;color:var(--muted);letter-spacing:.8px;text-transform:uppercase;}
    .form-body{padding:20px;}
    .field{margin-bottom:16px;}
    .field label{display:block;font-size:11px;font-weight:600;color:var(--muted);letter-spacing:.5px;text-transform:uppercase;margin-bottom:6px;}
    .field input,.field select{width:100%;padding:9px 12px;border:1px solid var(--border2);border-radius:3px;background:var(--bg);color:var(--text);font-family:var(--sans);font-size:13px;transition:border-color .15s;}
    .field input:focus,.field select:focus{outline:none;border-color:var(--navy);}
    .field-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
    .checkbox-group{display:flex;flex-direction:column;gap:10px;}
    .checkbox-item{display:flex;align-items:center;gap:10px;cursor:pointer;}
    .checkbox-item input[type=checkbox]{width:16px;height:16px;accent-color:var(--navy);cursor:pointer;}
    .checkbox-item span{font-size:13px;color:var(--text);}
    .submit-btn{width:100%;padding:11px;background:var(--navy);color:white;border:none;border-radius:3px;font-family:var(--sans);font-size:13px;font-weight:600;cursor:pointer;transition:all .15s;margin-top:4px;}
    .submit-btn:hover{background:var(--navy2);}
    .toast{display:none;margin-top:12px;padding:10px 14px;border-radius:3px;font-size:12px;font-family:var(--mono);}
    .toast.success{background:var(--green-dim);color:var(--green);border:1px solid rgba(30,126,74,0.2);}
    .toast.error{background:var(--red-dim);color:var(--red);border:1px solid rgba(192,57,43,0.2);}
    .table-card{background:var(--bg2);border:1px solid var(--border);border-radius:4px;overflow:hidden;}
    .table-card-header{padding:14px 20px;background:var(--bg3);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
    .table-card-title{font-size:11px;font-weight:600;color:var(--muted);letter-spacing:.8px;text-transform:uppercase;}
    .village-table{width:100%;border-collapse:collapse;font-size:13px;}
    .village-table th{text-align:left;font-size:10px;font-weight:600;color:var(--muted2);letter-spacing:.8px;text-transform:uppercase;padding:10px 16px;background:var(--bg3);border-bottom:1px solid var(--border);white-space:nowrap;}
    .village-table td{padding:12px 16px;border-bottom:1px solid var(--border);vertical-align:middle;}
    .village-table tr:last-child td{border-bottom:none;}
    .village-table tr:hover td{background:var(--bg3);}
    .v-name{font-weight:600;color:var(--navy);}
    .v-dist{font-size:11px;color:var(--muted2);margin-top:1px;}
    .threat-tag{display:inline-block;padding:2px 7px;border-radius:2px;font-size:10px;font-weight:600;font-family:var(--mono);}
    .threat-tag.both{background:rgba(26,39,68,0.08);color:var(--navy);}
    .threat-tag.glof{background:var(--green-dim);color:var(--green);}
    .threat-tag.flood{background:var(--orange-dim);color:var(--orange);}
    .bool-y{color:var(--green);font-size:12px;font-weight:600;}
    .bool-n{color:var(--red);font-size:12px;font-weight:600;}
    .delete-btn{padding:5px 12px;background:var(--red-dim);color:var(--red);border:1px solid rgba(192,57,43,0.2);border-radius:2px;font-size:11px;font-weight:600;cursor:pointer;font-family:var(--mono);transition:all .15s;}
    .delete-btn:hover{background:var(--red);color:white;}
    .fade-up{opacity:0;transform:translateY(8px);animation:fu .4s ease forwards;}
    @keyframes fu{to{opacity:1;transform:translateY(0);}}
    .d1{animation-delay:.05s}.d2{animation-delay:.1s}
  </style>
</head>
<body>

  <nav class="navbar">
    <a class="logo" href="index.html">
      <div class="logo-mark">‚òÇ</div>
      <div>
        <div class="logo-text">Umbrella</div>
        <div class="logo-sub">Disaster Intelligence ¬∑ Uttarakhand</div>
      </div>
    </a>
    <ul class="nav-links">
      <li><a href="index.html">Dashboard</a></li>
      <li><a href="map.html">Risk Map</a></li>
      <li><a href="vulnerability.html">Vulnerability</a></li>
      <li><a href="resources.html">Resources</a></li>
      <li><a href="admin.html" class="active">Admin</a></li>
    </ul>
  </nav>

  <div class="page-header">
    <div>
      <div class="page-eyebrow">Database Management ¬∑ Restricted Access</div>
      <div class="page-title">Admin Panel</div>
      <div class="page-desc">Add or remove villages from the live database</div>
    </div>
    <span id="status-badge" style="font-family:var(--mono);font-size:11px;padding:6px 14px;border-radius:2px;border:1px solid rgba(255,255,255,0.15);color:rgba(255,255,255,0.5);">
      ‚è≥ Connecting...
    </span>
  </div>

  <div class="admin-note">
    ‚ö† Changes affect live data immediately ¬∑ Road Safe field will be replaced by Road Access Routes in next formula update
  </div>

  <div class="content">

    <div class="form-card fade-up d1">
      <div class="form-header">
        <div class="form-title">+ Add New Village</div>
      </div>
      <div class="form-body">

        <div class="field">
          <label>Village Name</label>
          <input type="text" id="f-name" placeholder="e.g. Harsil">
        </div>

        <div class="field">
          <label>District</label>
          <select id="f-district">
            <option value="Uttarkashi">Uttarkashi</option>
            <option value="Chamoli">Chamoli</option>
            <option value="Rudraprayag">Rudraprayag</option>
            <option value="Tehri Garhwal">Tehri Garhwal</option>
            <option value="Pithoragarh">Pithoragarh</option>
            <option value="Haridwar">Haridwar</option>
          </select>
        </div>

        <div class="field-row">
          <div class="field">
            <label>Population</label>
            <input type="number" id="f-population" placeholder="e.g. 2500">
          </div>
          <div class="field">
            <label>GLOF Travel (min)</label>
            <input type="number" id="f-travel" placeholder="e.g. 35">
          </div>
        </div>

        <div class="field">
          <label>Threat Type</label>
          <select id="f-threat">
            <option value="BOTH">GLOF + Flood</option>
            <option value="GLOF">GLOF Only</option>
            <option value="FLOOD">Flood Only</option>
          </select>
        </div>

        <div class="field">
          <label>Additional Factors</label>
          <div class="checkbox-group">
            <label class="checkbox-item">
              <input type="checkbox" id="f-road">
              <span>Road is currently safe</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" id="f-history">
              <span>Historical disaster event</span>
            </label>
          </div>
        </div>

        <button class="submit-btn" onclick="addVillage()">Save to Database</button>
        <div class="toast" id="toast"></div>

      </div>
    </div>

    <div class="table-card fade-up d2">
      <div class="table-card-header">
        <span class="table-card-title" id="table-count">Loading villages...</span>
        <span style="font-family:var(--mono);font-size:10px;color:var(--muted2);">Live database</span>
      </div>
      <table class="village-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Village</th>
            <th>Threat</th>
            <th>Population</th>
            <th>Road Safe</th>
            <th>History</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="village-tbody">
          <tr><td colspan="7" style="text-align:center;color:var(--muted2);padding:32px;">Loading...</td></tr>
        </tbody>
      </table>
    </div>

  </div>

  <script>
    var BACKEND = "https://web-production-517aa.up.railway.app";

    function loadVillages() {
      fetch(BACKEND + "/admin/villages")
        .then(function(r){return r.json();})
        .then(function(data){
          var badge = document.getElementById('status-badge');
          badge.style.cssText = 'font-family:var(--mono);font-size:11px;padding:6px 14px;border-radius:2px;border:1px solid rgba(74,222,128,0.4);color:#4ade80;background:rgba(74,222,128,0.08);';
          badge.innerText = 'üü¢ Connected';

          var v = data.villages;
          document.getElementById('table-count').innerText = v.length + ' village' + (v.length!==1?'s':'') + ' in database';

          var html = '';
          v.forEach(function(row){
            var tc = row.threat_type==='BOTH'?'both':row.threat_type==='GLOF'?'glof':'flood';
            var tl = row.threat_type==='BOTH'?'GLOF+Flood':row.threat_type;
            html +=
              '<tr>' +
                '<td style="font-family:var(--mono);font-size:12px;color:var(--muted2)">'+row.id+'</td>' +
                '<td><div class="v-name">'+row.name+'</div><div class="v-dist">'+row.district+'</div></td>' +
                '<td><span class="threat-tag '+tc+'">'+tl+'</span></td>' +
                '<td style="font-family:var(--mono);font-size:13px">'+row.population.toLocaleString()+'</td>' +
                '<td><span class="'+(row.road_safe?'bool-y':'bool-n')+'">'+(row.road_safe?'‚úì Yes':'‚úó No')+'</span></td>' +
                '<td><span class="'+(row.historical_event?'bool-y':'bool-n')+'">'+(row.historical_event?'‚úì Yes':'‚úó No')+'</span></td>' +
                '<td><button class="delete-btn" onclick="deleteVillage('+row.id+',\''+row.name+'\')">Delete</button></td>' +
              '</tr>';
          });
          document.getElementById('village-tbody').innerHTML = html;
        })
        .catch(function(){
          document.getElementById('status-badge').innerText = 'üî¥ Server Offline';
          document.getElementById('village-tbody').innerHTML =
            '<tr><td colspan="7" style="text-align:center;color:var(--red);padding:32px;">‚ö† Backend offline</td></tr>';
        });
    }

    function addVillage(){
      var name = document.getElementById('f-name').value.trim();
      var pop  = parseInt(document.getElementById('f-population').value);
      var trav = parseInt(document.getElementById('f-travel').value);
      if(!name||!pop||!trav){showToast('Please fill in all required fields','error');return;}

      fetch(BACKEND+"/admin/add-village",{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body:JSON.stringify({
          name:name,
          district:document.getElementById('f-district').value,
          population:pop,
          travel_time:trav,
          threat_type:document.getElementById('f-threat').value,
          road_safe:document.getElementById('f-road').checked,
          historical_event:document.getElementById('f-history').checked
        })
      })
      .then(function(r){return r.json();})
      .then(function(){
        showToast('‚úì '+name+' added to database','success');
        document.getElementById('f-name').value='';
        document.getElementById('f-population').value='';
        document.getElementById('f-travel').value='';
        document.getElementById('f-road').checked=false;
        document.getElementById('f-history').checked=false;
        loadVillages();
      })
      .catch(function(){showToast('‚ö† Failed to add village','error');});
    }

    function deleteVillage(id,name){
      if(!confirm('Delete '+name+' from the database?'))return;
      fetch(BACKEND+"/admin/delete-village/"+id,{method:'DELETE'})
        .then(function(){loadVillages();})
        .catch(function(){showToast('‚ö† Failed to delete','error');});
    }

    function showToast(msg,type){
      var t=document.getElementById('toast');
      t.innerText=msg;t.className='toast '+type;t.style.display='block';
      setTimeout(function(){t.style.display='none';},3000);
    }

    loadVillages();
  </script>

</body>
</html>
